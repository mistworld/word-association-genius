<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ìƒì²œì¬ - IQ 140 ì—°ìƒí€´ì¦ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .screen {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: #00fffc;
        }

        .button {
            background: linear-gradient(135deg, #00fffc, #ff00ff);
            color: black;
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
        }

        .button:active {
            transform: scale(0.95);
        }

        .round-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .round-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .round-btn.completed {
            background: #00fffc;
            color: black;
        }

        .round-btn.current {
            background: #ff00ff;
            color: black;
        }

        .round-btn.locked {
            background: #666;
            color: #999;
            cursor: not-allowed;
        }

        .problem-info {
            text-align: center;
            margin-bottom: 20px;
            color: #00fffc;
        }

        .hint-box {
            background: rgba(0,255,252,0.1);
            border: 1px solid #00fffc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #00fffc;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .correct-answer {
            text-align: center;
            padding: 20px;
            background: rgba(0,255,252,0.1);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .key-count {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00fffc, #ff00ff);
            color: black;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            currentScreen: 'start',
            currentRound: 1,
            currentProblem: 0,
            keys: 15,
            completedRounds: [],
            problems: [],
            currentProblemState: null
        };

        // ë”ë¯¸ ë¬¸ì œ ë°ì´í„°
        const dummyProblems = [
            {
                hints: ["ì²« ë²ˆì§¸ íŒíŠ¸", "ë‘ ë²ˆì§¸ íŒíŠ¸", "ì„¸ ë²ˆì§¸ íŒíŠ¸", "ë„¤ ë²ˆì§¸ íŒíŠ¸", "ë‹¤ì„¯ ë²ˆì§¸ íŒíŠ¸", "ì—¬ì„¯ ë²ˆì§¸ íŒíŠ¸"],
                descriptions: ["ì²« ë²ˆì§¸ ì„¤ëª…", "ë‘ ë²ˆì§¸ ì„¤ëª…", "ì„¸ ë²ˆì§¸ ì„¤ëª…", "ë„¤ ë²ˆì§¸ ì„¤ëª…", "ë‹¤ì„¯ ë²ˆì§¸ ì„¤ëª…", "ì—¬ì„¯ ë²ˆì§¸ ì„¤ëª…"],
                answer: ["ì •ë‹µ1"],
                category: "í…ŒìŠ¤íŠ¸",
                chosung: "ã…ˆã„·1",
                characterCount: 3
            },
            {
                hints: ["íŒíŠ¸2-1", "íŒíŠ¸2-2", "íŒíŠ¸2-3", "íŒíŠ¸2-4", "íŒíŠ¸2-5", "íŒíŠ¸2-6"],
                descriptions: ["ì„¤ëª…2-1", "ì„¤ëª…2-2", "ì„¤ëª…2-3", "ì„¤ëª…2-4", "ì„¤ëª…2-5", "ì„¤ëª…2-6"],
                answer: ["ì •ë‹µ2"],
                category: "í…ŒìŠ¤íŠ¸",
                chosung: "ã…ˆã„·2",
                characterCount: 3
            }
        ];

        // ì €ì¥í•˜ê¸°
        function saveGameState() {
            localStorage.setItem('game_save', JSON.stringify(gameState));
        }

        // ë¶ˆëŸ¬ì˜¤ê¸°
        function loadGameState() {
            const saved = localStorage.getItem('game_save');
            if (saved) {
                Object.assign(gameState, JSON.parse(saved));
            }
        }

        // ì‹œì‘ í™”ë©´
        function showStartScreen() {
            gameState.currentScreen = 'start';
            const html = `
                <div class="container">
                    <div class="screen">
                        <div class="title">âš¡ì—°ìƒì²œì¬âš¡</div>
                        <button class="button" onclick="showRoundMap()">
                            ğŸ§  ê²Œì„ ì‹œì‘
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('app').innerHTML = html;
        }

        // ë¼ìš´ë“œ ë§µ
        function showRoundMap() {
            loadGameState();
            gameState.currentScreen = 'roundMap';
            
            const html = `
                <div class="container">
                    <div class="screen">
                        <div class="title">ë¼ìš´ë“œ ì„ íƒ</div>
                        <div class="round-grid">
                            ${[1,2,3,4,5,6].map(round => {
                                const isCompleted = gameState.completedRounds.includes(round);
                                const maxCompleted = gameState.completedRounds.length > 0 ? 
                                    Math.max(...gameState.completedRounds) : 0;
                                const isCurrent = round === maxCompleted + 1;
                                const isLocked = round > maxCompleted + 1 && !isCompleted;
                                
                                return `
                                    <button class="round-btn ${isCompleted ? 'completed' : isCurrent ? 'current' : isLocked ? 'locked' : 'current'}"
                                        onclick="${isLocked ? '' : `startRound(${round})`}"
                                        ${isLocked ? 'disabled' : ''}>
                                        ${round}${isCompleted ? 'âœ…' : isCurrent ? 'â­' : isLocked ? 'ğŸ”’' : 'ğŸ¯'}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                        <button class="button" onclick="showStartScreen()">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>
                    </div>
                    <div class="key-count">ğŸ”‘ ${gameState.keys}</div>
                </div>
            `;
            document.getElementById('app').innerHTML = html;
        }

        // ë¼ìš´ë“œ ì‹œì‘ - âœ… 1ë²ˆ ë¬¸ì œ í•´ê²°
        function startRound(roundNumber) {
            gameState.currentScreen = 'game';
            gameState.currentRound = roundNumber;
            
            const savedState = JSON.parse(localStorage.getItem('game_save') || '{}');
            
            // âœ… 1. ì´ì–´í•˜ê¸° ê¸°ëŠ¥: ì €ì¥ëœ ìœ„ì¹˜ë¶€í„° ì‹œì‘
            let currentProblem = 0;
            if (savedState.currentRound === roundNumber && savedState.currentProblem !== undefined) {
                currentProblem = savedState.currentProblem;
                // ì €ì¥ëœ ë¬¸ì œê°€ ì´ë¯¸ í’€ë ¸ìœ¼ë©´ ë‹¤ìŒ ë¬¸ì œë¡œ
                if (savedState.currentProblemState && savedState.currentProblemState.isCorrect) {
                    currentProblem = Math.min(currentProblem + 1, 1); // 2ë¬¸ì œë§Œ ìˆìœ¼ë¯€ë¡œ 1ê¹Œì§€
                }
            }
            
            gameState.currentProblem = currentProblem;
            gameState.problems = [dummyProblems[0], dummyProblems[1]]; // 2ë¬¸ì œë§Œ
            
            // âœ… 2. ì´ë¯¸ í’€ë¦° ë¬¸ì œì¸ì§€ í™•ì¸
            const isAlreadySolved = savedState.currentProblemState && 
                                  savedState.currentRound === roundNumber && 
                                  savedState.currentProblem === currentProblem && 
                                  savedState.currentProblemState.isCorrect;
            
            gameState.currentProblemState = {
                unlockedHints: isAlreadySolved ? [0,1,2,3,4,5] : [0, 1],
                isCorrect: isAlreadySolved ? true : false,
                userAnswer: ''
            };
            
            renderGameScreen();
            saveGameState();
        }

        // ê²Œì„ í™”ë©´
        function renderGameScreen() {
            const problem = gameState.problems[gameState.currentProblem];
            const state = gameState.currentProblemState;
            
            const html = `
                <div class="container">
                    <div class="screen">
                        <div class="problem-info">
                            ë¼ìš´ë“œ ${gameState.currentRound} - ë¬¸ì œ ${gameState.currentProblem + 1}
                        </div>
                        
                        ${problem.hints.map((hint, index) => `
                            <div class="hint-box">
                                ${state.unlockedHints.includes(index) ? hint : 'ğŸ”’ ì ê¸´ íŒíŠ¸'}
                            </div>
                        `).join('')}
                        
                        ${!state.isCorrect ? `
                            <input type="text" class="answer-input" placeholder="ì •ë‹µ ì…ë ¥" 
                                value="${state.userAnswer}"
                                oninput="updateUserAnswer(this.value)"
                                onkeydown="if(event.key === 'Enter') checkAnswer(this.value)">
                            <button class="button" onclick="checkAnswer(document.querySelector('.answer-input').value)">
                                ì •ë‹µ ì œì¶œ
                            </button>
                        ` : `
                            <div class="correct-answer">
                                <div>ğŸ¯ ì •ë‹µ: ${problem.answer[0]}</div>
                                <div>ğŸ“š ë¶„ë¥˜: ${problem.category}</div>
                                ${state.isCorrect ? '<div style="color: #ff00ff; margin-top: 10px;">ì´ë¯¸ í‘¼ ë¬¸ì œì…ë‹ˆë‹¤</div>' : ''}
                            </div>
                            <button class="button" onclick="nextProblem()">
                                ${gameState.currentProblem === 1 ? 'ğŸ† ë¼ìš´ë“œ ì™„ë£Œ' : 'âœ ë‹¤ìŒ ë¬¸ì œ'}
                            </button>
                        `}
                        
                        <button class="button" onclick="showRoundMap()" style="background: #666; margin-top: 10px;">
                            ğŸ—ºï¸ ë¼ìš´ë“œë§µ
                        </button>
                    </div>
                    <div class="key-count">ğŸ”‘ ${gameState.keys}</div>
                </div>
            `;
            document.getElementById('app').innerHTML = html;
        }

        // âœ… 2. ì •ë‹µ í™•ì¸ - ì´ë¯¸ í‘¼ ë¬¸ì œëŠ” ì²´í¬ ë¶ˆê°€
        function checkAnswer(value) {
            const problem = gameState.problems[gameState.currentProblem];
            const state = gameState.currentProblemState;
            
            // ì´ë¯¸ í‘¼ ë¬¸ì œë©´ ì²´í¬ ë¶ˆê°€
            if (state.isCorrect) {
                alert('ì´ë¯¸ í‘¼ ë¬¸ì œì…ë‹ˆë‹¤!');
                return;
            }
            
            if (value === problem.answer[0]) {
                // ì²œì¬ë³´ë„ˆìŠ¤: íŒíŠ¸ 2ê°œ ì´í•˜ ì‚¬ìš© ì‹œ
                if (state.unlockedHints.length <= 2) {
                    gameState.keys += 1;
                    alert('ğŸ‰ ì²œì¬ë³´ë„ˆìŠ¤! ì—´ì‡  1ê°œ íšë“!');
                }
                
                state.isCorrect = true;
                state.unlockedHints = [0,1,2,3,4,5]; // ëª¨ë“  íŒíŠ¸ ì˜¤í”ˆ
                renderGameScreen();
                saveGameState();
            } else {
                alert('âŒ í‹€ë ¸ìŠµë‹ˆë‹¤! ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.');
            }
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextProblem() {
            if (gameState.currentProblem < 1) { // 2ë¬¸ì œë§Œ ìˆìœ¼ë¯€ë¡œ
                gameState.currentProblem++;
                gameState.currentProblemState = {
                    unlockedHints: [0, 1],
                    isCorrect: false,
                    userAnswer: ''
                };
                renderGameScreen();
                saveGameState();
            } else {
                // âœ… 2. ë¼ìš´ë“œ ì™„ë£Œ ë³´ìƒ ì¤‘ë³µ ë°©ì§€
                if (!gameState.completedRounds.includes(gameState.currentRound)) {
                    gameState.keys += 1;
                    gameState.completedRounds.push(gameState.currentRound);
                    alert('ğŸŠ ë¼ìš´ë“œ ì™„ë£Œ! ì—´ì‡  1ê°œ íšë“!');
                }
                showRoundComplete();
                saveGameState();
            }
        }

        function updateUserAnswer(value) {
            gameState.currentProblemState.userAnswer = value;
        }

        function showRoundComplete() {
            const html = `
                <div class="container">
                    <div class="screen">
                        <div class="title">ğŸ‰ ë¼ìš´ë“œ ${gameState.currentRound} ì™„ë£Œ!</div>
                        <button class="button" onclick="startRound(${gameState.currentRound + 1})">
                            ğŸš€ ë‹¤ìŒ ë¼ìš´ë“œ
                        </button>
                        <button class="button" onclick="showRoundMap()">
                            ğŸ—ºï¸ ë¼ìš´ë“œë§µ
                        </button>
                    </div>
                    <div class="key-count">ğŸ”‘ ${gameState.keys}</div>
                </div>
            `;
            document.getElementById('app').innerHTML = html;
        }

        // âœ… 3. ë’¤ë¡œê°€ê¸° ì²˜ë¦¬ (ê°„ë‹¨í•œ ë²„ì „)
        window.addEventListener('popstate', function(event) {
            if (gameState.currentScreen === 'game') {
                if (confirm('ë¼ìš´ë“œë§µìœ¼ë¡œ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    showRoundMap();
                }
            } else if (gameState.currentScreen === 'roundMap') {
                if (confirm('ê²Œì„ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    // ì¢…ë£Œ ì²˜ë¦¬
                }
            }
        });

        // ì•± ì‹œì‘
        loadGameState();
        showStartScreen();
    </script>
</body>
</html>