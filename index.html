<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연상천재 - IQ 140 연상퀴즈</title>
    <meta name="description" content="당신은 천재인가요? 시냅스가 연결되는 짜릿한 쾌감을 느껴보세요!">
    <meta name="theme-color" content="#6A0DAD">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a0b2e 0%, #2d1b69 100%);
            min-height: 100vh;
            color: #ffffff;
        }

        .container {
            max-width: 100%;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .start-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

        .title-main {
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #E040FB, #00BCD4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .start-button {
            background: linear-gradient(135deg, #9C27B0, #E040FB);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .main-content {
            background: white;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            flex: 1;
            margin-top: auto;
            color: #2c3e50;
        }

        .round-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .round-button {
            aspect-ratio: 1;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .round-button.current {
            background: linear-gradient(135deg, #9C27B0, #E040FB);
            color: white;
        }

        .round-button.locked {
            background: #f0f0f0;
            color: #ccc;
            cursor: not-allowed;
        }

        .hint-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin: 10px 0;
        }

        .submit-button {
            width: 100%;
            background: linear-gradient(135deg, #9C27B0, #E040FB);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // 게임 상태 관리
        let gameState = {
            currentScreen: 'start',
            currentRound: 1,
            currentProblem: 0,
            keys: 15,
            completedRounds: [],
            problems: [],
            currentProblemState: null
        };

        // 시작 화면
        function renderStartScreen() {
            const html = `
                <div class="container">
                    <div class="start-screen">
                        <div class="title-main">⚡연상천재⚡</div>
                        <div style="margin-bottom: 10px; color: #E040FB;">뇌가 터질 것 같은 쾌감</div>
                        <div style="margin-bottom: 30px; color: #00BCD4;">당신은 IQ 140 천재입니까?</div>
                        <button class="start-button" onclick="showRoundMap()">
                            🧠 시냅스 가동
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('app').innerHTML = html;
        }

        // 라운드 맵
        function showRoundMap() {
            const nextRound = gameState.completedRounds.length > 0 ? 
                Math.max(...gameState.completedRounds) + 1 : 1;
            
            const html = `
                <div class="container">
                    <div class="header">
                        <div style="color: #6A0DAD; font-weight: bold;">연상천재</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="background: #FFD93D; color: #2d1b69; padding: 5px 10px; border-radius: 15px; font-weight: bold;">
                                🔑 ${gameState.keys}
                            </div>
                        </div>
                    </div>
                    
                    <div class="main-content">
                        <h2 style="text-align: center; margin-bottom: 20px; color: #6A0DAD;">
                            라운드 선택
                        </h2>
                        <div class="round-grid">
                            ${Array.from({ length: 100 }, (_, i) => {
                                const roundNumber = i + 1;
                                const isCompleted = gameState.completedRounds.includes(roundNumber);
                                const isCurrent = roundNumber === nextRound;
                                const isLocked = roundNumber > nextRound;
                                
                                return `
                                    <button 
                                        class="round-button ${isCompleted ? 'current' : isCurrent ? 'current' : isLocked ? 'locked' : 'current'}"
                                        onclick="${isLocked ? '' : `startRound(${roundNumber})`}"
                                        ${isLocked ? 'disabled' : ''}
                                    >
                                        ${roundNumber}
                                        ${isCompleted ? '✅' : isCurrent ? '⭐' : isLocked ? '🔒' : '🎯'}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('app').innerHTML = html;
            gameState.currentScreen = 'roundMap';
        }

        // 라운드 시작 - 간단한 버전
        async function startRound(roundNumber) {
            try {
                console.log(`라운드 ${roundNumber} 시작`);
                
                // problems_1.json 파일 로드
                const response = await fetch('problems_1.json');
                
                if (!response.ok) {
                    throw new Error('problems_1.json 파일을 찾을 수 없습니다');
                }
                
                const allProblems = await response.json();
                console.log('총 문제 수:', allProblems.length);
                
                // 해당 라운드 문제 선택 (라운드당 6문제)
                const problemsPerRound = 6;
                const startIndex = (roundNumber - 1) * problemsPerRound;
                const roundProblems = allProblems.slice(startIndex, startIndex + problemsPerRound);

                if (roundProblems.length === 0) {
                    alert('이 라운드에는 문제가 없습니다');
                    return;
                }
                
                gameState.currentRound = roundNumber;
                gameState.currentProblem = 0;
                gameState.problems = roundProblems;
                
                // 문제 상태 초기화
                gameState.currentProblemState = {
                    unlockedHints: [0, 1], // 처음 2개 힌트 해금
                    userAnswer: '',
                    isCorrect: false
                };
                
                renderGame();
                
            } catch (error) {
                console.error('라운드 시작 실패:', error);
                alert('문제를 불러오는데 실패했습니다: ' + error.message);
                showRoundMap();
            }
        }

        // 게임 화면
        function renderGame() {
            if (!gameState.currentProblemState || gameState.problems.length === 0) {
                showRoundMap();
                return;
            }

            const problem = gameState.problems[gameState.currentProblem];
            const state = gameState.currentProblemState;

            const html = `
                <div class="container">
                    <div class="header">
                        <button onclick="showRoundMap()" style="background: #9C27B0; color: white; border: none; border-radius: 10px; padding: 8px 12px; cursor: pointer;">🏠</button>
                        <div style="color: #6A0DAD; font-weight: bold;">
                            라운드 ${gameState.currentRound} - 문제 ${gameState.currentProblem + 1}/6
                        </div>
                        <div style="background: #FFD93D; color: #2d1b69; padding: 5px 10px; border-radius: 15px; font-weight: bold;">
                            🔑 ${gameState.keys}
                        </div>
                    </div>
                    
                    <div class="main-content">
                        <div style="margin-bottom: 20px;">
                            ${problem.hints.map((hint, index) => {
                                const isUnlocked = state.unlockedHints.includes(index);
                                return `
                                    <div class="hint-item" style="opacity: ${isUnlocked ? '1' : '0.5'};">
                                        <div style="font-weight: bold; margin-bottom: 5px;">힌트 ${index + 1}</div>
                                        <div>${isUnlocked ? hint : '🔒 잠긴 힌트'}</div>
                                        ${!isUnlocked && index >= 2 ? `
                                            <button onclick="unlockHint(${index})" style="background: #F1948A; color: white; border: none; border-radius: 5px; padding: 5px 10px; margin-top: 5px; cursor: pointer;">
                                                🔓1 해금
                                            </button>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        ${!state.isCorrect ? `
                            <div>
                                <input 
                                    type="text" 
                                    class="answer-input" 
                                    placeholder="정답을 입력하세요"
                                    value="${state.userAnswer}"
                                    oninput="updateUserAnswer(this.value)"
                                    onkeydown="if(event.key === 'Enter') checkAnswer(this.value)"
                                />
                                <button class="submit-button" onclick="checkAnswer()">
                                    입력
                                </button>
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 24px; margin-bottom: 10px;">🎯 정답!</div>
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">${problem.answer.join(', ')}</div>
                                <button class="submit-button" onclick="nextProblem()">
                                    ${gameState.currentProblem === 5 ? '라운드 완료' : '다음 문제'}
                                </button>
                            </div>
                        `}
                    </div>
                </div>
            `;
            
            document.getElementById('app').innerHTML = html;
        }

        // 게임 기능들
        function unlockHint(hintIndex) {
            if (gameState.keys > 0) {
                gameState.keys--;
                gameState.currentProblemState.unlockedHints.push(hintIndex);
                renderGame();
            } else {
                alert('열쇠가 부족합니다!');
            }
        }

        function updateUserAnswer(value) {
            gameState.currentProblemState.userAnswer = value;
        }

        function checkAnswer() {
            const problem = gameState.problems[gameState.currentProblem];
            const state = gameState.currentProblemState;
            const userAnswer = state.userAnswer.toLowerCase().replace(/\s+/g, '');
            
            const correctAnswers = problem.answer.map(ans => 
                ans.toLowerCase().replace(/\s+/g, '')
            );
            
            if (correctAnswers.includes(userAnswer)) {
                state.isCorrect = true;
                renderGame();
            } else {
                alert('틀렸습니다! 다시 시도해보세요.');
            }
        }

        function nextProblem() {
            if (gameState.currentProblem < 5) {
                gameState.currentProblem++;
                gameState.currentProblemState = {
                    unlockedHints: [0, 1],
                    userAnswer: '',
                    isCorrect: false
                };
                renderGame();
            } else {
                gameState.completedRounds.push(gameState.currentRound);
                gameState.keys += 1;
                alert('라운드 완료! +1 열쇠 획득!');
                showRoundMap();
            }
        }

        // 앱 시작
        renderStartScreen();
    </script>
</body>
</html>